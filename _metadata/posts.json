{
	"/webpack/2019-04-22-uglifyjs-to-terser": {
		"path": "/webpack/2019-04-22-uglifyjs-to-terser",
		"content": "<p>최근 <a href=\"https://github.com/salgum1114/react-design-editor\">React Design Editor</a>에 빌드 실패 관련 이슈가 올라왔다.</p>\n<p>내용인 즉슨, <code>production</code>으로 빌드시 UglifyJsPlugin에서 <code>Unexpected token: keyword «const»</code>라는 오류가 발생하여 계속해서 빌드에 실패한다는 것이다.</p>\n<p><a href=\"https://github.com/salgum1114/react-design-editor/issues/101\">[Bug] Not able to create build for the application #101</a></p>\n<pre><code class=\"hljs shell language-shell\"><span class=\"hljs-meta\">react-design-editor&gt;</span><span class=\"bash\"> npm run build</span>\n\nreact-design-editor@0.0.1 build D:\\Projects\\VirtualTutor\\vt-bkp\\react-design-editor\nwebpack -p --config webpack.prod.js\n\nclean-webpack-plugin: D:\\Projects\\VirtualTutor\\vt-bkp\\react-design-editor\\public\\js has been removed.\nHash: 6f635a8eff2d04c3d630\nVersion: webpack 4.30.0\nTime: 28583ms\nBuilt at: 04/19/2019 4:12:58 PM\n129 assets\nEntrypoint app = js/1.784bfc366d4d89f7.js js/app.359b7dab68a97eb6.js\n[17] (webpack)/buildin/harmony-module.js 573 bytes {1} [built]\n[45] ./node_modules/rc-animate/es/Animate.js + 3 modules 17.1 KiB {1} [built]\n| 4 modules\n[65] (webpack)/buildin/global.js 472 bytes {1} [built]\n[193] (webpack)/buildin/module.js 497 bytes {1} [built]\n[557] jsdom (ignored) 15 bytes {0} {1} [built]\n[558] jsdom/lib/jsdom/living/generated/utils (ignored) 15 bytes {0} {1} [built]\n[559] jsdom/lib/jsdom/utils (ignored) 15 bytes {0} {1} [built]\n[560] xmldom (ignored) 15 bytes {0} {1} [built]\n[765] ./src/containers/App.js 3.46 KiB {0} [built]\n[845] ./src/registerServiceWorker.js 6.72 KiB {0} [built]\n[846] ./src/i18n/index.js 53 bytes {0} [built]\n[1134] multi @babel/polyfill ./src/index.js 40 bytes {0} [built]\n[1310] ./src/index.js 1.72 KiB {0} [built]\n[1705] ./node_modules/antd/es/index.js + 303 modules 1.55 MiB {1} [built]\n| 304 modules\n[1708] multi react react-dom lodash fabric antd 76 bytes {1} [built]\n+ 1694 hidden modules\n\nERROR in js/1.784bfc366d4d89f7.js from UglifyJs\nUnexpected token: keyword «const» [./node_modules/@babel/polyfill/lib/index.js:6,0][js/1.784bfc366d4d89f7.js:185555,2]\nChild html-webpack-plugin for \"index.html\":\n1 asset\nEntrypoint undefined = index.html\n[2] (webpack)/buildin/global.js 472 bytes {0} [built]\n[3] (webpack)/buildin/module.js 497 bytes {0} [built]\n+ 2 hidden modules\nnpm ERR! code ELIFECYCLE\nnpm ERR! errno 2\nnpm ERR! react-design-editor@0.0.1 build: webpack -p --config webpack.prod.js\nnpm ERR! Exit status 2\nnpm ERR!\nnpm ERR! Failed at the react-design-editor@0.0.1 build script.\nnpm ERR! This is probably not a problem with npm. There is likely additional logging output above.\n\nnpm ERR! A complete log of this run can be found in:\nnpm ERR! C:\\Users\\manish.kumar.GATEWAYGROUP\\AppData\\Roaming\\npm-cache_logs\\2019-04-19T10_42_59_421Z-debug.log\n</code></pre>\n<p><code>babel polyfill</code>시 뭔가 충돌나는 것 같아 나와 비슷한 사례를 찾기 위해 구글링을 해본다.</p>\n<p>최근 이슈는 아니지만, 비슷한 사례가 많이 나온다.</p>\n<p><img src=\"/images/webpack/uglifyjs-const-issue-search.png\" alt=\"uglify-js-issue\" /></p>\n<p><a href=\"https://github.com/webpack-contrib/uglifyjs-webpack-plugin/issues/362\">첫번째 이슈</a> 사이트에서 내용을 읽어보니, UglifyJsPlugin 버전 2부터 uglify-es가 버려졌으니 es6를 사용하고 싶으면 terser-webpack-plugin을 사용하라는 내용인것 같다.</p>\n<p>실제로 확인해보니 <a href=\"https://github.com/webpack-contrib/uglifyjs-webpack-plugin/releases/tag/v2.0.0\">uglifyjs-webpack-plugin 릴리즈 태그 v2.0 Change Log</a>에 내용이 있었다.</p>\n<p><img src=\"/images/webpack/uglifyjs-v2-change-log.png\" alt=\"uglify-js-2.0\" /></p>\n<blockquote>\n  <p>근데 terser가 무슨 뜻이지? naver 사전에서는 간결한 이라고 나온다.</p>\n</blockquote>\n<p>아무튼 <a href=\"https://github.com/salgum1114/react-design-editor/issues/101\">이슈</a> 해결을 위해 <code>uglifyjs-webpack-plugin</code>에서 <code>terser-webpack-plugin</code>으로 변경을 시도해본다.</p>\n<p>우선 변경을 위해 <a href=\"https://github.com/webpack-contrib/terser-webpack-plugin\">terser-webpack-plugin</a> github에서 사용방법을 찾아봤다.</p>\n<p>찾아보니 terser-webpack-plugin과 uglifyjs-webpack-plugin의 사용법이 크게 다르지 않았다.</p>\n<h3 id=\"uglifyjswebpackplugin\">기존 uglifyjs-webpack-plugin 옵션</h3>\n<pre><code class=\"hljs javascript language-javascript\">optimization: {\n    <span class=\"hljs-attr\">minimizer</span>: [\n        <span class=\"hljs-keyword\">new</span> UglifyJsPlugin({\n            <span class=\"hljs-attr\">cache</span>: <span class=\"hljs-literal\">true</span>,\n            <span class=\"hljs-attr\">parallel</span>: <span class=\"hljs-literal\">true</span>,\n            <span class=\"hljs-attr\">uglifyOptions</span>: {\n                <span class=\"hljs-attr\">warnings</span>: <span class=\"hljs-literal\">false</span>,\n                <span class=\"hljs-attr\">compress</span>: {\n                    <span class=\"hljs-attr\">warnings</span>: <span class=\"hljs-literal\">false</span>,\n                    <span class=\"hljs-attr\">unused</span>: <span class=\"hljs-literal\">true</span>,\n                },\n                <span class=\"hljs-attr\">ecma</span>: <span class=\"hljs-number\">6</span>,\n                <span class=\"hljs-attr\">mangle</span>: <span class=\"hljs-literal\">true</span>,\n                <span class=\"hljs-attr\">unused</span>: <span class=\"hljs-literal\">true</span>,\n            },\n            <span class=\"hljs-attr\">sourceMap</span>: <span class=\"hljs-literal\">true</span>,\n        }),\n    ],\n},\n</code></pre>\n<h3 id=\"terserwebpackplugin\">변경할 terser-webpack-plugin 옵션</h3>\n<pre><code class=\"hljs javascript language-javascript\">optimization: {\n    <span class=\"hljs-attr\">minimizer</span>: [\n        <span class=\"hljs-keyword\">new</span> TerserPlugin({\n            <span class=\"hljs-attr\">cache</span>: <span class=\"hljs-literal\">true</span>,\n            <span class=\"hljs-attr\">parallel</span>: <span class=\"hljs-literal\">true</span>,\n            <span class=\"hljs-attr\">terserOptions</span>: {\n                <span class=\"hljs-attr\">warnings</span>: <span class=\"hljs-literal\">false</span>,\n                <span class=\"hljs-attr\">compress</span>: {\n                    <span class=\"hljs-attr\">warnings</span>: <span class=\"hljs-literal\">false</span>,\n                    <span class=\"hljs-attr\">unused</span>: <span class=\"hljs-literal\">true</span>,\n                },\n                <span class=\"hljs-attr\">ecma</span>: <span class=\"hljs-number\">6</span>,\n                <span class=\"hljs-attr\">mangle</span>: <span class=\"hljs-literal\">true</span>,\n                <span class=\"hljs-attr\">unused</span>: <span class=\"hljs-literal\">true</span>,\n            },\n            <span class=\"hljs-attr\">sourceMap</span>: <span class=\"hljs-literal\">true</span>,\n        }),\n    ],\n},\n</code></pre>\n<p>기본적인 옵션은 같고, <code>uglifyOptions</code>에서 <code>terserOptions</code>으로 변경하면 되는 것 같다.</p>\n<p>이제 변경된 옵션으로 <a href=\"https://github.com/salgum1114/react-design-editor\">React Design Editor</a>를 빌드해본다.</p>\n<p><img src=\"/images/webpack/terser-webpack-plugin-build.png\" alt=\"terser-webpack-plugin-build\" /></p>\n<h4 id=\"\">성공한것 같다.</h4>\n<p><em>마지막으로 요청자에게 이슈를 해결했다는 코멘트를 달아주는것으로 마무리한다.</em></p>",
		"title": "UglifyJsPlugin const 오류 해결 방법",
		"author": "salgum1114",
		"date": "2019-04-22 21:05",
		"tags": "webpack, uglifyjs, terser-webpack-plugin",
		"cover": "/images/covers/webpack.png"
	}
}